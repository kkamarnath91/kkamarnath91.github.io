<!DOCTYPE html>
<html>
  <head>
    <script src="//code.jquery.com/jquery-2.1.1.min.js"></script>
    <!--
    Load CartoDB's code so we can pull in our CartoDB maps.
    -->
    <link rel="stylesheet" href="http://libs.cartocdn.com/cartodb.js/v3/3.15/themes/css/cartodb.css" />
    <script src="http://libs.cartocdn.com/cartodb.js/v3/3.15/cartodb.js"></script>
    
    <style>
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
        width: 100%;
      }

      #map {
        height: 100%;
        width: 100%;
      }
      
      .queens-checkbox-wrapper {
        position: absolute;
        top: 15px;
        right: 15px;
      }
    </style>

    <script>
      var dataLayer;
      $(document).ready(function () {
        //
        // Initialize map from CartoDB: create the map and store the data layer for later
        //
        cartodb.createVis('map', 'https://amark490.cartodb.com/api/v2/viz/e4adf5da-0758-11e6-8ee2-0e787de82d45/viz.json')
          .done(function (vis, layers) {
            // Store the data layer for later:
            //  * layers[0] is the base layer (eg OpenStreetMap)
            //  * layers[1] is where all of your data layers go, and they're stored as "sublayers". The first one is numbered 0, the second is 1, etc. In this case we're getting the first sublayer.
            dataLayer = layers[1].getSubLayer(0);
          });
        
        //
        // Update the SQL by looking at all the checkboxes and creating the SQL with all of them.
        //
        function updateSql() {
          // Start with assuming we'll select everything
          var sql = "SELECT * FROM nypd_motor_vehicle_collisions_june_2015";
          
          // This will be the list of conditions, if anything's selected
          var whereConditions = [];
          
          // If Queens is checked add a where condition
          if ($('.queens-checkbox').is(':checked')) {
            whereConditions.push("borough = 'QUEENS'");
          }
          
          // If Bronx is checked add another where condition
          if ($('.bronx-checkbox').is(':checked')) {
            whereConditions.push("borough = 'BRONX'");
          }
          
          // If anything was checked, add "WHERE" and combine all of the conditions with "OR"
          if (whereConditions.length > 0) {
            sql += ' WHERE ' + whereConditions.join(' OR ');
          }
          
          // Log out the SQL to ensure we have something that will work
          console.log(sql);
          dataLayer.setSQL(sql);
        }

        //
        // Initialize the checkboxes: add an event handler to watch for change
        //
        $('.queens-checkbox').change(function () {
          updateSql();
        });
        $('.bronx-checkbox').change(function () {
          updateSql();
        });
      });
    </script>
  </head>
  <body>
    <div id="map"></div>
    <div class="queens-checkbox-wrapper">
      <input type="checkbox" class="queens-checkbox">Queens
      <input type="checkbox" class="bronx-checkbox">Bronx
    </div>
  </body>
</html>
